/*
 jQuery Text Highlighter
 Copyright (C) 2012 by mirz

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(b,t,q,r){var n,p;function v(i,d){this.context=i;this.$context=b(i);this.options=b.extend({},b[n].defaults,d);this.init()}p=1;n="textHighlighter";v.prototype={init:function(){this.$context.addClass(this.options.contextClass);this.bindEvents()},destroy:function(){this.unbindEvents();this.$context.removeClass(this.options.contextClass);this.$context.removeData(n)},bindEvents:function(){this.$context.bind("mouseup",{self:this},this.highlightHandler)},unbindEvents:function(){this.$context.unbind("mouseup",
this.highlightHandler)},highlightHandler:function(b){b.data.self.doHighlight()},doHighlight:function(){var i=this.getCurrentRange();if(i&&!i.collapsed){var d=i.toString();if(!0==this.options.onBeforeHighlight(i)){var f=b.textHighlighter.createWrapper(this.options);this.options.onAfterHighlight(this.normalizeHighlights(this.highlightRange(i,f)),d)}this.removeAllRanges()}},getCurrentRange:function(){var b=this.getCurrentSelection(),d;0<b.rangeCount&&(d=b.getRangeAt(0));return d},removeAllRanges:function(){this.getCurrentSelection().removeAllRanges()},
getCurrentSelection:function(){var i=this.getCurrentWindow(),d;i.getSelection?d=i.getSelection():b("iframe").length?b("iframe",top.document).each(function(){if(this.contentWindow===i)return d=rangy.getIframeSelection(this),!1}):d=rangy.getSelection();return d},getCurrentWindow:function(){var b=this.getCurrentDocument();return b.defaultView?b.defaultView:b.parentWindow},getCurrentDocument:function(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange:function(i,
d){if(!i.collapsed){var f="SCRIPT STYLE SELECT BUTTON OBJECT APPLET".split(" "),e=i.startContainer,l=i.endContainer,s=i.commonAncestorContainer,j=!0;if(0==i.endOffset){for(;!l.previousSibling&&l.parentNode!=s;)l=l.parentNode;l=l.previousSibling}else 3==l.nodeType?i.endOffset<l.nodeValue.length&&l.splitText(i.endOffset):0<i.endOffset&&(l=l.childNodes.item(i.endOffset-1));3==e.nodeType?i.startOffset==e.nodeValue.length?j=!1:0<i.startOffset&&(e=e.splitText(i.startOffset),l==e.previousSibling&&(l=e)):
e=i.startOffset<e.childNodes.length?e.childNodes.item(i.startOffset):e.nextSibling;var s=!1,m=[];do{if(j&&3==e.nodeType){if(/\S/.test(e.nodeValue)){var j=d.clone(!0).get(0),c=e.parentNode;if(b.contains(this.context,c)||c===this.context)j=b(e).wrap(j).parent().get(0),m.push(j)}j=!1}if(e==l&&(!l.hasChildNodes()||!j))s=!0;-1!=b.inArray(e.tagName,f)&&(j=!1);j&&e.hasChildNodes()?e=e.firstChild:null!=e.nextSibling?(e=e.nextSibling,j=!0):(e=e.parentNode,j=!1)}while(!s);return m}},normalizeHighlights:function(i){this.flattenNestedHighlights(i);
this.mergeSiblingHighlights(i);return b.map(i,function(b){return"undefined"!=typeof b.parentElement?null!=b.parentElement?b:null:null!=b.parentNode?b:null})},flattenNestedHighlights:function(i){var d=this;b.each(i,function(f){var e=b(this),l=e.parent(),s=l.prev(),j=l.next();d.isHighlight(l)&&(l.css("background-color")!=e.css("background-color")?(d.isHighlight(s)&&(s.css("background-color")!=l.css("background-color")&&s.css("background-color")==e.css("background-color"))&&e.insertAfter(s),d.isHighlight(j)&&
(j.css("background-color")!=l.css("background-color")&&j.css("background-color")==e.css("background-color"))&&e.insertBefore(j),l.is(":empty")&&l.remove()):(e=q.createTextNode(l.text()),l.empty(),l.append(e),b(i[f]).remove()))})},mergeSiblingHighlights:function(i){function d(d,l){return l&&l.nodeType==p&&b(d).css("background-color")==b(l).css("background-color")&&b(l).hasClass(f.options.highlightedClass)?!0:!1}var f=this;b.each(i,function(){var f=this.previousSibling,l=this.nextSibling;if(d(this,
f)){var i=b(f).text()+b(this).text();b(this).text(i);b(f).remove()}d(this,l)&&(i=b(this).text()+b(l).text(),b(this).text(i),b(l).remove())})},setColor:function(b){this.options.color=b},getColor:function(){return this.options.color},removeHighlights:function(i){var d=this;this.getAllHighlights(i!==r?i:this.context,!0).each(function(){if(!0==d.options.onRemoveHighlight(this)){var f=b(this).contents().unwrap().get(0),e=f.previousSibling,l=f.nextSibling;e&&3==e.nodeType&&(f.nodeValue=e.nodeValue+f.nodeValue,
e.parentNode.removeChild(e));l&&3==l.nodeType&&(f.nodeValue+=l.nodeValue,l.parentNode.removeChild(l))}})},getAllHighlights:function(i,d){var f="."+this.options.highlightedClass,f=b(i).find(f);!0==d&&b(i).hasClass(this.options.highlightedClass)&&(f=f.add(i));return f},isHighlight:function(b){return b.hasClass(this.options.highlightedClass)}};b.fn.getHighlighter=function(){return this.data(n)};b.fn[n]=function(i){return this.each(function(){b.data(this,n)||b.data(this,n,new v(this,i))})};b.textHighlighter=
{createWrapper:function(i){return b("<span></span>").css("backgroundColor",i.color).addClass(i.highlightedClass)},defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}}}})(jQuery,window,document);window.rangy=function(){function b(c,b){var o=typeof c[b];return"function"==o||!!("object"==o&&c[b])||"unknown"==o}function t(c,b){return!!("object"==typeof c[b]&&c[b])}function q(c,b){return"undefined"!=typeof c[b]}function r(c){return function(b,o){for(var d=o.length;d--;)if(!c(b,o[d]))return!1;return!0}}function n(c){return c&&s(c,l)&&m(c,e)}function p(b){window.alert("Rangy not supported in your browser. Reason: "+b);c.initialized=!0;c.supported=!1}function v(){if(!c.initialized){var e,j=!1,l=
!1;b(document,"createRange")&&(e=document.createRange(),s(e,f)&&m(e,d)&&(j=!0),e.detach());if((e=t(document,"body")?document.body:document.getElementsByTagName("body")[0])&&b(e,"createTextRange"))e=e.createTextRange(),n(e)&&(l=!0);!j&&!l&&p("Neither Range nor TextRange are implemented");c.initialized=!0;c.features={implementsDomRange:j,implementsTextRange:l};j=z.concat(o);l=0;for(e=j.length;l<e;++l)try{j[l](c)}catch(i){t(window,"console")&&b(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
i)}}}function i(c){this.name=c;this.supported=this.initialized=!1}var d="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),f="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),e="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),
l="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),s=r(b),j=r(t),m=r(q),c={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:b,isHostObject:t,isHostProperty:q,areHostMethods:s,areHostObjects:j,areHostProperties:m,isTextRange:n},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};c.fail=p;c.warn=function(b){b="Rangy warning: "+b;c.config.alertOnWarn?window.alert(b):
"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(b)};({}).hasOwnProperty?c.util.extend=function(c,b){for(var o in b)b.hasOwnProperty(o)&&(c[o]=b[o])}:p("hasOwnProperty not supported");var o=[],z=[];c.init=v;c.addInitListener=function(b){c.initialized?b(c):o.push(b)};var y=[];c.addCreateMissingNativeApiListener=function(c){y.push(c)};c.createMissingNativeApi=function(c){c=c||window;v();for(var b=0,o=y.length;b<o;++b)y[b](c)};i.prototype.fail=function(c){this.initialized=
!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+c);};i.prototype.warn=function(b){c.warn("Module "+this.name+": "+b)};i.prototype.createError=function(c){return Error("Error in Rangy "+this.name+" module: "+c)};c.createModule=function(b,o){var d=new i(b);c.modules[b]=d;z.push(function(c){o(c,d);d.initialized=!0;d.supported=!0})};c.requireModules=function(b){for(var o=0,d=b.length,e,f;o<d;++o){f=b[o];e=c.modules[f];if(!e||!(e instanceof i))throw Error("Module '"+f+"' not found");
if(!e.supported)throw Error("Module '"+f+"' not supported");}};var B=!1,j=function(){B||(B=!0,c.initialized||v())};if("undefined"==typeof window)p("No window found");else if("undefined"==typeof document)p("No document found");else return b(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",j,!1),b(window,"addEventListener")?window.addEventListener("load",j,!1):b(window,"attachEvent")?window.attachEvent("onload",j):p("Window does not have required addEventListener or attachEvent method"),
c}();
rangy.createModule("DomUtil",function(b,t){function q(c){for(var b=0;c=c.previousSibling;)b++;return b}function r(c,b){var d=[],e;for(e=c;e;e=e.parentNode)d.push(e);for(e=b;e;e=e.parentNode)if(m(d,e))return e;return null}function n(c,b,d){for(d=d?c:c.parentNode;d;){c=d.parentNode;if(c===b)return d;d=c}return null}function p(c){c=c.nodeType;return 3==c||4==c||8==c}function v(c,b){var d=b.nextSibling,e=b.parentNode;d?e.insertBefore(c,d):e.appendChild(c);return c}function i(c){if(9==c.nodeType)return c;if("undefined"!=
typeof c.ownerDocument)return c.ownerDocument;if("undefined"!=typeof c.document)return c.document;if(c.parentNode)return i(c.parentNode);throw Error("getDocument: no document found for node");}function d(c){return!c?"[No node]":p(c)?'"'+c.data+'"':1==c.nodeType?"<"+c.nodeName+(c.id?' id="'+c.id+'"':"")+">["+c.childNodes.length+"]":c.nodeName}function f(c){this._next=this.root=c}function e(c,b){this.node=c;this.offset=b}function l(c){this.code=this[c];this.codeName=c;this.message="DOMException: "+
this.codeName}var s=b.util;s.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method");s.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var j=document.createElement("div");s.areHostMethods(j,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation");s.isHostProperty(j,"innerHTML")||t.fail("Element is missing innerHTML property");j=document.createTextNode("test");
s.areHostMethods(j,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation");var m=function(c,b){for(var d=c.length;d--;)if(c[d]===b)return!0;return!1};f.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var c=this._current=this._next,b;if(this._current){if(!(b=c.firstChild))for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};e.prototype={equals:function(c){return this.node===c.node&this.offset==c.offset},inspect:function(){return"[DomPosition("+d(this.node)+":"+this.offset+")]"}};l.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};l.prototype.toString=function(){return this.message};b.dom={arrayContains:m,isHtmlNamespace:function(c){var b;return"undefined"==typeof c.namespaceURI||null===(b=c.namespaceURI)||
"http://www.w3.org/1999/xhtml"==b},parentElement:function(c){c=c.parentNode;return 1==c.nodeType?c:null},getNodeIndex:q,getNodeLength:function(c){var b;return p(c)?c.length:(b=c.childNodes)?b.length:0},getCommonAncestor:r,isAncestorOf:function(c,b,d){for(b=d?b:b.parentNode;b;){if(b===c)return!0;b=b.parentNode}return!1},getClosestAncestorIn:n,isCharacterDataNode:p,insertAfter:v,splitDataNode:function(c,b){var d=c.cloneNode(!1);d.deleteData(0,b);c.deleteData(b,c.length-b);v(d,c);return d},getDocument:i,
getWindow:function(c){c=i(c);if("undefined"!=typeof c.defaultView)return c.defaultView;if("undefined"!=typeof c.parentWindow)return c.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(c){if("undefined"!=typeof c.contentWindow)return c.contentWindow;if("undefined"!=typeof c.contentDocument)return c.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(c){if("undefined"!=typeof c.contentDocument)return c.contentDocument;
if("undefined"!=typeof c.contentWindow)return c.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(c){return s.isHostObject(c,"body")?c.body:c.getElementsByTagName("body")[0]},getRootContainer:function(c){for(var b;b=c.parentNode;)c=b;return c},comparePoints:function(c,b,d,e){var f;if(c==d)return b===e?0:b<e?-1:1;if(f=n(d,c,!0))return b<=q(f)?-1:1;if(f=n(c,d,!0))return q(f)<e?-1:1;b=r(c,d);c=c===b?b:n(c,b,!0);d=d===b?b:n(d,b,!0);if(c===
d)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(b=b.firstChild;b;){if(b===c)return-1;if(b===d)return 1;b=b.nextSibling}throw Error("Should not be here!");},inspectNode:d,fragmentFromNodeChildren:function(b){for(var d=i(b).createDocumentFragment(),e;e=b.firstChild;)d.appendChild(e);return d},createIterator:function(b){return new f(b)},DomPosition:e};b.DOMException=l});
rangy.createModule("DomRange",function(b){function t(g,a){return 3!=g.nodeType&&(h.isAncestorOf(g,a.startContainer,!0)||h.isAncestorOf(g,a.endContainer,!0))}function q(g){return h.getDocument(g.startContainer)}function r(g,a,b){if(a=g._listeners[a])for(var c=0,k=a.length;c<k;++c)a[c].call(g,{target:g,args:b})}function n(g){return new H(g.parentNode,h.getNodeIndex(g))}function p(g){return new H(g.parentNode,h.getNodeIndex(g)+1)}function v(g,a,b){var c=11==g.nodeType?g.firstChild:g;h.isCharacterDataNode(a)?
b==a.length?h.insertAfter(g,a):a.parentNode.insertBefore(g,0==b?a:h.splitDataNode(a,b)):b>=a.childNodes.length?a.appendChild(g):a.insertBefore(g,a.childNodes[b]);return c}function i(g){for(var a,b,c=q(g.range).createDocumentFragment();b=g.next();){a=g.isPartiallySelectedSubtree();b=b.cloneNode(!a);a&&(a=g.getSubtreeIterator(),b.appendChild(i(a)),a.detach(!0));if(10==b.nodeType)throw new A("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function d(g,a,b){for(var c,k,b=b||{stop:!1};c=g.next();)if(g.isPartiallySelectedSubtree())if(!1===
a(c)){b.stop=!0;break}else{if(c=g.getSubtreeIterator(),d(c,a,b),c.detach(!0),b.stop)break}else for(c=h.createIterator(c);k=c.next();)if(!1===a(k)){b.stop=!0;return}}function f(g){for(var a;g.next();)g.isPartiallySelectedSubtree()?(a=g.getSubtreeIterator(),f(a),a.detach(!0)):g.remove()}function e(g){for(var a,b=q(g.range).createDocumentFragment(),c;a=g.next();){g.isPartiallySelectedSubtree()?(a=a.cloneNode(!1),c=g.getSubtreeIterator(),a.appendChild(e(c)),c.detach(!0)):g.remove();if(10==a.nodeType)throw new A("HIERARCHY_REQUEST_ERR");
b.appendChild(a)}return b}function l(g,a,b){var c=!(!a||!a.length),k,e=!!b;c&&(k=RegExp("^("+a.join("|")+")$"));var f=[];d(new j(g,!1),function(g){(!c||k.test(g.nodeType))&&(!e||b(g))&&f.push(g)});return f}function s(g){return"["+("undefined"==typeof g.getName?"Range":g.getName())+"("+h.inspectNode(g.startContainer)+":"+g.startOffset+", "+h.inspectNode(g.endContainer)+":"+g.endOffset+")]"}function j(g,a){this.range=g;this.clonePartiallySelectedTextNodes=a;if(!g.collapsed){this.sc=g.startContainer;
this.so=g.startOffset;this.ec=g.endContainer;this.eo=g.endOffset;var b=g.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===b&&!h.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:h.getClosestAncestorIn(this.sc,b,!0),this._last=this.ec===b&&!h.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:h.getClosestAncestorIn(this.ec,b,!0))}}function m(g){this.code=
this[g];this.codeName=g;this.message="RangeException: "+this.codeName}function c(g,a,b){this.nodes=l(g,a,b);this._next=this.nodes[0];this._position=0}function o(g){return function(a,b){for(var c,k=b?a:a.parentNode;k;){c=k.nodeType;if(h.arrayContains(g,c))return k;k=k.parentNode}return null}}function z(g,a){if(ba(g,a))throw new m("INVALID_NODE_TYPE_ERR");}function y(g){if(!g.startContainer)throw new A("INVALID_STATE_ERR");}function B(g,a){if(!h.arrayContains(a,g.nodeType))throw new m("INVALID_NODE_TYPE_ERR");
}function L(g,a){if(0>a||a>(h.isCharacterDataNode(g)?g.length:g.childNodes.length))throw new A("INDEX_SIZE_ERR");}function D(a,b){if(I(a,!0)!==I(b,!0))throw new A("WRONG_DOCUMENT_ERR");}function C(a){if(ca(a,!0))throw new A("NO_MODIFICATION_ALLOWED_ERR");}function x(a,b){if(!a)throw new A(b);}function F(a){return!!a.startContainer&&!!a.endContainer&&!(!h.arrayContains(M,a.startContainer.nodeType)&&!I(a.startContainer,!0))&&!(!h.arrayContains(M,a.endContainer.nodeType)&&!I(a.endContainer,!0))&&a.startOffset<=
(h.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length)&&a.endOffset<=(h.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)}function u(a){y(a);if(!F(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function N(){}function G(a){a.START_TO_START=S;a.START_TO_END=W;a.END_TO_END=da;a.END_TO_START=X;a.NODE_BEFORE=Y;a.NODE_AFTER=Z;a.NODE_BEFORE_AND_AFTER=$;a.NODE_INSIDE=T}function E(a){G(a);
G(a.prototype)}function O(a,b){return function(){u(this);var c=this.startContainer,k=this.startOffset,e=this.commonAncestorContainer,f=new j(this,!0);c!==e&&(c=h.getClosestAncestorIn(c,e,!0),k=p(c),c=k.node,k=k.offset);d(f,C);f.reset();e=a(f);f.detach();b(this,c,k,c,k);return e}}function Q(a,c,d){function o(a,b){return function(g){y(this);B(g,J);B(k(g),M);g=(a?n:p)(g);(b?I:l)(this,g.node,g.offset)}}function I(a,g,b){var d=a.endContainer,e=a.endOffset;if(g!==a.startContainer||b!==a.startOffset){if(k(g)!=
k(d)||1==h.comparePoints(g,b,d,e))d=g,e=b;c(a,g,b,d,e)}}function l(a,g,b){var d=a.startContainer,e=a.startOffset;if(g!==a.endContainer||b!==a.endOffset){if(k(g)!=k(d)||-1==h.comparePoints(g,b,d,e))d=g,e=b;c(a,d,e,g,b)}}a.prototype=new N;b.util.extend(a.prototype,{setStart:function(a,g){y(this);z(a,!0);L(a,g);I(this,a,g)},setEnd:function(a,g){y(this);z(a,!0);L(a,g);l(this,a,g)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(a){u(this);a?
c(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){y(this);z(a,!0);c(this,a,0,a,h.getNodeLength(a))},selectNode:function(a){y(this);z(a,!1);B(a,J);var g=n(a),a=p(a);c(this,g.node,g.offset,a.node,a.offset)},extractContents:O(e,c),deleteContents:O(f,c),canSurroundContents:function(){u(this);C(this.startContainer);C(this.endContainer);var a=new j(this,!0),g=a._first&&
t(a._first,this)||a._last&&t(a._last,this);a.detach();return!g},detach:function(){d(this)},splitBoundaries:function(){u(this);var a=this.startContainer,g=this.startOffset,b=this.endContainer,k=this.endOffset,d=a===b;h.isCharacterDataNode(b)&&0<k&&k<b.length&&h.splitDataNode(b,k);h.isCharacterDataNode(a)&&(0<g&&g<a.length)&&(a=h.splitDataNode(a,g),d?(k-=g,b=a):b==a.parentNode&&k>=h.getNodeIndex(a)&&k++,g=0);c(this,a,g,b,k)},normalizeBoundaries:function(){u(this);var a=this.startContainer,g=this.startOffset,
b=this.endContainer,k=this.endOffset,d=function(a){var g=a.nextSibling;g&&g.nodeType==a.nodeType&&(b=a,k=a.length,a.appendData(g.data),g.parentNode.removeChild(g))},e=function(c){var d=c.previousSibling;if(d&&d.nodeType==c.nodeType){a=c;var e=c.length;g=d.length;c.insertData(0,d.data);d.parentNode.removeChild(d);a==b?(k+=g,b=a):b==c.parentNode&&(d=h.getNodeIndex(c),k==d?(b=c,k=e):k>d&&k--)}},f=!0;h.isCharacterDataNode(b)?b.length==k&&d(b):(0<k&&(f=b.childNodes[k-1])&&h.isCharacterDataNode(f)&&d(f),
f=!this.collapsed);f?h.isCharacterDataNode(a)?0==g&&e(a):g<a.childNodes.length&&(d=a.childNodes[g])&&h.isCharacterDataNode(d)&&e(d):(a=b,g=k);c(this,a,g,b,k)},collapseToPoint:function(a,g){y(this);z(a,!0);L(a,g);(a!==this.startContainer||g!==this.startOffset||a!==this.endContainer||g!==this.endOffset)&&c(this,a,g,a,g)}});E(a)}function P(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:h.getCommonAncestor(a.startContainer,
a.endContainer)}function R(a,b,c,k,d){var e=a.startContainer!==b||a.startOffset!==c,f=a.endContainer!==k||a.endOffset!==d;a.startContainer=b;a.startOffset=c;a.endContainer=k;a.endOffset=d;P(a);r(a,"boundarychange",{startMoved:e,endMoved:f})}function w(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};P(this)}b.requireModules(["DomUtil"]);var h=b.dom,H=h.DomPosition,A=b.DOMException;j.prototype={_current:null,_next:null,_first:null,
_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,h.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,b,c;h.isCharacterDataNode(a)&&
(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return t(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new w(q(this.range));var b=this._current,c=b,k=0,d=b,e=h.getNodeLength(b);h.isAncestorOf(b,this.sc,!0)&&(c=this.sc,k=this.so);h.isAncestorOf(b,this.ec,!0)&&(d=
this.ec,e=this.eo);R(a,c,k,d,e)}return new j(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};m.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};m.prototype.toString=function(){return this.message};c.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},
detach:function(){this._current=this._next=this.nodes=null}};var J=[1,3,4,5,7,8,10],M=[2,9,11],K=[1,3,4,5,7,8,10,11],a=[1,3,4,5,7,8],k=h.getRootContainer,I=o([9,11]),ca=o([5,6,10,12]),ba=o([6,10,12]),aa=document.createElement("style"),U=!1;try{aa.innerHTML="<b>x</b>",U=3==aa.firstChild.nodeType}catch(ea){}b.features.htmlParsingConforms=U;var V="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),S=0,W=1,da=2,X=3,Y=0,Z=1,$=2,T=3;N.prototype={attachListener:function(a,
b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){u(this);D(this.startContainer,b.startContainer);var c=a==X||a==S?"start":"end",k=a==W||a==S?"start":"end";return h.comparePoints(this[c+"Container"],this[c+"Offset"],b[k+"Container"],b[k+"Offset"])},insertNode:function(a){u(this);B(a,K);C(this.startContainer);if(h.isAncestorOf(a,this.startContainer,!0))throw new A("HIERARCHY_REQUEST_ERR");this.setStartBefore(v(a,this.startContainer,this.startOffset))},cloneContents:function(){u(this);
var a,b;if(this.collapsed)return q(this).createDocumentFragment();if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=q(this).createDocumentFragment(),b.appendChild(a),b;b=new j(this,!0);a=i(b);b.detach();return a},canSurroundContents:function(){u(this);C(this.startContainer);C(this.endContainer);var a=new j(this,!0),b=a._first&&t(a._first,this)||a._last&&t(a._last,
this);a.detach();return!b},surroundContents:function(b){B(b,a);if(!this.canSurroundContents())throw new m("BAD_BOUNDARYPOINTS_ERR");var c=this.extractContents();if(b.hasChildNodes())for(;b.lastChild;)b.removeChild(b.lastChild);v(b,this.startContainer,this.startOffset);b.appendChild(c);this.selectNode(b)},cloneRange:function(){u(this);for(var a=new w(q(this)),b=V.length,c;b--;)c=V[b],a[c]=this[c];return a},toString:function(){u(this);var a=this.startContainer;if(a===this.endContainer&&h.isCharacterDataNode(a))return 3==
a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],a=new j(this,!0);d(a,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){u(this);var b=a.parentNode,c=h.getNodeIndex(a);if(!b)throw new A("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return 0>a?0<b?$:Y:0<b?Z:T},comparePoint:function(a,b){u(this);x(a,"HIERARCHY_REQUEST_ERR");D(a,this.startContainer);return 0>h.comparePoints(a,b,this.startContainer,
this.startOffset)?-1:0<h.comparePoints(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:U?function(a){var b=this.startContainer,c=h.getDocument(b);if(!b)throw new A("INVALID_STATE_ERR");var k=null;1==b.nodeType?k=b:h.isCharacterDataNode(b)&&(k=h.parentElement(b));k=null===k||"HTML"==k.nodeName&&h.isHtmlNamespace(h.getDocument(k).documentElement)&&h.isHtmlNamespace(k)?c.createElement("body"):k.cloneNode(!1);k.innerHTML=a;return h.fragmentFromNodeChildren(k)}:function(a){y(this);
var b=q(this).createElement("body");b.innerHTML=a;return h.fragmentFromNodeChildren(b)},toHtml:function(){u(this);var a=q(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,b){u(this);x(a,"NOT_FOUND_ERR");if(h.getDocument(a)!==q(this))return!1;var c=a.parentNode,k=h.getNodeIndex(a);x(c,"NOT_FOUND_ERR");var d=h.comparePoints(c,k,this.endContainer,this.endOffset),c=h.comparePoints(c,k+1,this.startContainer,this.startOffset);return b?0>=d&&0<=
c:0>d&&0<c},isPointInRange:function(a,b){u(this);x(a,"HIERARCHY_REQUEST_ERR");D(a,this.startContainer);return 0<=h.comparePoints(a,b,this.startContainer,this.startOffset)&&0>=h.comparePoints(a,b,this.endContainer,this.endOffset)},intersectsRange:function(a,b){u(this);if(q(a)!=q(this))throw new A("WRONG_DOCUMENT_ERR");var c=h.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),k=h.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=
c&&0<=k:0>c&&0<k},intersection:function(a){if(this.intersectsRange(a)){var b=h.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=h.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),k=this.cloneRange();-1==b&&k.setStart(a.startContainer,a.startOffset);1==c&&k.setEnd(a.endContainer,a.endOffset);return k}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();-1==h.comparePoints(a.startContainer,a.startOffset,this.startContainer,
this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==h.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new m("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==T},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,h.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=
this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return 0<c.length?(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){u(this);return new c(this,a,b)},getNodes:function(a,b){u(this);return l(this,a,b)},getDocument:function(){return q(this)},collapseBefore:function(a){y(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){y(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},
equals:function(a){return w.rangesEqual(this,a)},isValid:function(){return F(this)},inspect:function(){return s(this)}};Q(w,R,function(a){y(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;r(a,"detach",null);a._listeners=null});b.rangePrototype=N.prototype;w.rangeProperties=V;w.RangeIterator=j;w.copyComparisonConstants=E;w.createPrototypeRange=Q;w.inspect=s;w.getRangeDocument=q;w.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&
a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset};b.DomRange=w;b.RangeException=m});
rangy.createModule("WrappedRange",function(b){function t(b,f,e,l){var i=b.duplicate();i.collapse(e);var j=i.parentElement();n.isAncestorOf(f,j,!0)||(j=f);if(!j.canHaveHTML)return new p(j.parentNode,n.getNodeIndex(j));var f=n.getDocument(j).createElement("span"),m,c=e?"StartToStart":"StartToEnd";do j.insertBefore(f,f.previousSibling),i.moveToElementText(f);while(0<(m=i.compareEndPoints(c,b))&&f.previousSibling);c=f.nextSibling;if(-1==m&&c&&n.isCharacterDataNode(c)){i.setEndPoint(e?"EndToStart":"EndToEnd",
b);if(/[\r\n]/.test(c.data)){j=i.duplicate();e=j.text.replace(/\r\n/g,"\r").length;for(e=j.moveStart("character",e);-1==j.compareEndPoints("StartToEnd",j);)e++,j.moveStart("character",1)}else e=i.text.length;j=new p(c,e)}else c=(l||!e)&&f.previousSibling,j=(e=(l||e)&&f.nextSibling)&&n.isCharacterDataNode(e)?new p(e,0):c&&n.isCharacterDataNode(c)?new p(c,c.length):new p(j,n.getNodeIndex(f));f.parentNode.removeChild(f);return j}function q(b,f){var e,l,i=b.offset,j=n.getDocument(b.node),m=j.body.createTextRange(),
c=n.isCharacterDataNode(b.node);c?(e=b.node,l=e.parentNode):(e=b.node.childNodes,e=i<e.length?e[i]:null,l=b.node);j=j.createElement("span");j.innerHTML="&#feff;";e?l.insertBefore(j,e):l.appendChild(j);m.moveToElementText(j);m.collapse(!f);l.removeChild(j);if(c)m[f?"moveStart":"moveEnd"]("character",i);return m}b.requireModules(["DomUtil","DomRange"]);var r,n=b.dom,p=n.DomPosition,v=b.DomRange;if(b.features.implementsDomRange&&(!b.features.implementsTextRange||!b.config.preferTextRange))(function(){function d(b){for(var c=
e.length,d;c--;)d=e[c],b[d]=b.nativeRange[d]}var f,e=v.rangeProperties,l,i;r=function(b){if(!b)throw Error("Range must be specified");this.nativeRange=b;d(this)};v.createPrototypeRange(r,function(b,c,d,e,f){var i=b.endContainer!==e||b.endOffset!=f;if(b.startContainer!==c||b.startOffset!=d||i)b.setEnd(e,f),b.setStart(c,d)},function(b){b.nativeRange.detach();b.detached=!0;for(var c=e.length,d;c--;)d=e[c],b[d]=null});f=r.prototype;f.selectNode=function(b){this.nativeRange.selectNode(b);d(this)};f.deleteContents=
function(){this.nativeRange.deleteContents();d(this)};f.extractContents=function(){var b=this.nativeRange.extractContents();d(this);return b};f.cloneContents=function(){return this.nativeRange.cloneContents()};f.surroundContents=function(b){this.nativeRange.surroundContents(b);d(this)};f.collapse=function(b){this.nativeRange.collapse(b);d(this)};f.cloneRange=function(){return new r(this.nativeRange.cloneRange())};f.refresh=function(){d(this)};f.toString=function(){return this.nativeRange.toString()};
var j=document.createTextNode("test");n.getBody(document).appendChild(j);var m=document.createRange();m.setStart(j,0);m.setEnd(j,0);try{m.setStart(j,1),l=!0,f.setStart=function(b,c){this.nativeRange.setStart(b,c);d(this)},f.setEnd=function(b,c){this.nativeRange.setEnd(b,c);d(this)},i=function(b){return function(c){this.nativeRange[b](c);d(this)}}}catch(c){l=!1,f.setStart=function(b,c){try{this.nativeRange.setStart(b,c)}catch(e){this.nativeRange.setEnd(b,c),this.nativeRange.setStart(b,c)}d(this)},
f.setEnd=function(b,c){try{this.nativeRange.setEnd(b,c)}catch(e){this.nativeRange.setStart(b,c),this.nativeRange.setEnd(b,c)}d(this)},i=function(b,c){return function(e){try{this.nativeRange[b](e)}catch(f){this.nativeRange[c](e),this.nativeRange[b](e)}d(this)}}}f.setStartBefore=i("setStartBefore","setEndBefore");f.setStartAfter=i("setStartAfter","setEndAfter");f.setEndBefore=i("setEndBefore","setStartBefore");f.setEndAfter=i("setEndAfter","setStartAfter");m.selectNodeContents(j);f.selectNodeContents=
m.startContainer==j&&m.endContainer==j&&0==m.startOffset&&m.endOffset==j.length?function(b){this.nativeRange.selectNodeContents(b);d(this)}:function(b){this.setStart(b,0);this.setEnd(b,v.getEndOffset(b))};m.selectNodeContents(j);m.setEnd(j,3);l=document.createRange();l.selectNodeContents(j);l.setEnd(j,4);l.setStart(j,2);f.compareBoundaryPoints=-1==m.compareBoundaryPoints(m.START_TO_END,l)&1==m.compareBoundaryPoints(m.END_TO_START,l)?function(b,c){c=c.nativeRange||c;b==c.START_TO_END?b=c.END_TO_START:
b==c.END_TO_START&&(b=c.START_TO_END);return this.nativeRange.compareBoundaryPoints(b,c)}:function(b,c){return this.nativeRange.compareBoundaryPoints(b,c.nativeRange||c)};b.util.isHostMethod(m,"createContextualFragment")&&(f.createContextualFragment=function(b){return this.nativeRange.createContextualFragment(b)});n.getBody(document).removeChild(j);m.detach();l.detach()})(),b.createNativeRange=function(b){b=b||document;return b.createRange()};else if(b.features.implementsTextRange){r=function(b){this.textRange=
b;this.refresh()};r.prototype=new v(document);r.prototype.refresh=function(){var b,f,e=this.textRange;b=e.parentElement();var i=e.duplicate();i.collapse(!0);f=i.parentElement();i=e.duplicate();i.collapse(!1);e=i.parentElement();f=f==e?f:n.getCommonAncestor(f,e);f=f==b?f:n.getCommonAncestor(b,f);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?f=b=t(this.textRange,f,!0,!0):(b=t(this.textRange,f,!0,!1),f=t(this.textRange,f,!1,!1));this.setStart(b.node,b.offset);this.setEnd(f.node,f.offset)};
v.copyComparisonConstants(r);var i=function(){return this}();"undefined"==typeof i.Range&&(i.Range=r);b.createNativeRange=function(b){b=b||document;return b.body.createTextRange()}}b.features.implementsTextRange&&(r.rangeToTextRange=function(b){if(b.collapsed)return q(new p(b.startContainer,b.startOffset),!0);var f=q(new p(b.startContainer,b.startOffset),!0),e=q(new p(b.endContainer,b.endOffset),!1),b=n.getDocument(b.startContainer).body.createTextRange();b.setEndPoint("StartToStart",f);b.setEndPoint("EndToEnd",
e);return b});r.prototype.getName=function(){return"WrappedRange"};b.WrappedRange=r;b.createRange=function(d){d=d||document;return new r(b.createNativeRange(d))};b.createRangyRange=function(b){b=b||document;return new v(b)};b.createIframeRange=function(d){return b.createRange(n.getIframeDocument(d))};b.createIframeRangyRange=function(d){return b.createRangyRange(n.getIframeDocument(d))};b.addCreateMissingNativeApiListener(function(d){d=d.document;if(typeof d.createRange=="undefined")d.createRange=
function(){return b.createRange(this)};d=d=null})});
rangy.createModule("WrappedSelection",function(b,t){function q(a){return(a||window).getSelection()}function r(a){return(a||window).document.selection}function n(a,b,c){var d=c?"end":"start",c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function p(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function v(a){var k;a instanceof z?(k=a._selectionNativeRange,
k||(k=b.createNativeRange(c.getDocument(a.startContainer)),k.setEnd(a.endContainer,a.endOffset),k.setStart(a.startContainer,a.startOffset),a._selectionNativeRange=k,a.attachListener("detach",function(){this._selectionNativeRange=null}))):a instanceof y?k=a.nativeRange:b.features.implementsDomRange&&a instanceof c.getWindow(a.startContainer).Range&&(k=a);return k}function i(a){var b=a.getNodes(),d;a:if(!b.length||1!=b[0].nodeType)d=!1;else{d=1;for(var e=b.length;d<e;++d)if(!c.isAncestorOf(b[0],b[d])){d=
!1;break a}d=!0}if(!d)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function d(a,b){var c=new y(b);a._ranges=[c];n(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function f(a){a._ranges.length=0;if("None"==a.docSelection.type)p(a);else{var k=a.docSelection.createRange();if(k&&"undefined"!=typeof k.text)d(a,k);else{a.rangeCount=k.length;for(var e,f=c.getDocument(k.item(0)),i=0;i<a.rangeCount;++i)e=b.createRange(f),e.selectNode(k.item(i)),
a._ranges.push(e);a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed;n(a,a._ranges[a.rangeCount-1],!1)}}}function e(a,b){for(var d=a.docSelection.createRange(),e=i(b),h=c.getDocument(d.item(0)),h=c.getBody(h).createControlRange(),j=0,l=d.length;j<l;++j)h.add(d.item(j));try{h.add(e)}catch(m){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}h.select();f(a)}function l(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function s(a,b){for(var d=c.getDocument(b[0].startContainer),d=c.getBody(d).createControlRange(),e=0,h;e<rangeCount;++e){h=i(b[e]);try{d.add(h)}catch(j){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();f(a)}function j(a,b){if(a.anchorNode&&c.getDocument(a.anchorNode)!==c.getDocument(b))throw new B("WRONG_DOCUMENT_ERR");}function m(a){var b=[],c=new L(a.anchorNode,a.anchorOffset),
d=new L(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,h=a.rangeCount;f<h;++f)b[f]=z.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}b.requireModules(["DomUtil","DomRange","WrappedRange"]);b.config.checkSelectionRanges=!0;var c=b.dom,o=b.util,z=b.DomRange,y=b.WrappedRange,B=b.DOMException,L=c.DomPosition,D,C,x=b.util.isHostMethod(window,"getSelection"),
F=b.util.isHostObject(document,"selection"),u=F&&(!x||b.config.preferTextRange);u?(D=r,b.isSelectionValid=function(a){var a=(a||window).document,b=a.selection;return"None"!=b.type||c.getDocument(b.createRange().parentElement())==a}):x?(D=q,b.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected.");b.getNativeSelection=D;var x=D(),N=b.createNativeRange(document),G=c.getBody(document),E=o.areHostObjects(x,o.areHostProperties(x,["anchorOffset","focusOffset"]));
b.features.selectionHasAnchorAndFocus=E;var O=o.isHostMethod(x,"extend");b.features.selectionHasExtend=O;var Q="number"==typeof x.rangeCount;b.features.selectionHasRangeCount=Q;var P=!1,R=!0;o.areHostMethods(x,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof x.rangeCount&&b.features.implementsDomRange&&function(){var a=document.createElement("iframe");a.frameBorder=0;a.style.position="absolute";a.style.left="-10000px";G.appendChild(a);var b=c.getIframeDocument(a);b.open();b.write("<html><head></head><body>12</body></html>");
b.close();var d=c.getIframeWindow(a).getSelection(),e=b.documentElement.lastChild.firstChild,b=b.createRange();b.setStart(e,1);b.collapse(true);d.addRange(b);R=d.rangeCount==1;d.removeAllRanges();var f=b.cloneRange();b.setStart(e,0);f.setEnd(e,2);d.addRange(b);d.addRange(f);P=d.rangeCount==2;b.detach();f.detach();G.removeChild(a)}();b.features.selectionSupportsMultipleRanges=P;b.features.collapsedNonEditableSelectionsSupported=R;var w=!1,h;G&&o.isHostMethod(G,"createControlRange")&&(h=G.createControlRange(),
o.areHostProperties(h,["item","add"])&&(w=!0));b.features.implementsControlRange=w;C=E?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:false};var H;o.isHostMethod(x,"getRangeAt")?H=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:E&&(H=function(a){var d=c.getDocument(a.anchorNode),d=b.createRange(d);d.setStart(a.anchorNode,a.anchorOffset);d.setEnd(a.focusNode,a.focusOffset);if(d.collapsed!==
this.isCollapsed){d.setStart(a.focusNode,a.focusOffset);d.setEnd(a.anchorNode,a.anchorOffset)}return d});b.getSelection=function(a){var a=a||window,b=a._rangySelection,c=D(a),d=F?r(a):null;if(b){b.nativeSelection=c;b.docSelection=d;b.refresh(a)}else{b=new l(c,d,a);a._rangySelection=b}return b};b.getIframeSelection=function(a){return b.getSelection(c.getIframeWindow(a))};h=l.prototype;if(!u&&E&&o.areHostMethods(x,["removeAllRanges","addRange"])){h.removeAllRanges=function(){this.nativeSelection.removeAllRanges();
p(this)};var A=function(a,c){var d=z.getRangeDocument(c),d=b.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);a.nativeSelection.addRange(v(d));a.nativeSelection.extend(c.startContainer,c.startOffset);a.refresh()};h.addRange=Q?function(a,c){if(w&&F&&this.docSelection.type=="Control")e(this,a);else if(c&&O)A(this,a);else{var d;if(P)d=this.rangeCount;else{this.removeAllRanges();d=0}this.nativeSelection.addRange(v(a));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(b.config.checkSelectionRanges&&
(d=H(this.nativeSelection,this.rangeCount-1))&&!z.rangesEqual(d,a))a=new y(d);this._ranges[this.rangeCount-1]=a;n(this,a,K(this.nativeSelection));this.isCollapsed=C(this)}else this.refresh()}}:function(a,b){if(b&&O)A(this,a);else{this.nativeSelection.addRange(v(a));this.refresh()}};h.setRanges=function(a){if(w&&a.length>1)s(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(o.isHostMethod(x,"empty")&&o.isHostMethod(N,"select")&&w&&u)h.removeAllRanges=
function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=c.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();b.length&&(a=c.getDocument(b.item(0)).body.createTextRange())}if(a){a.body.createTextRange().select();this.docSelection.empty()}}}catch(d){}p(this)},h.addRange=function(a){if(this.docSelection.type=="Control")e(this,a);else{y.rangeToTextRange(a).select();this._ranges[0]=a;this.rangeCount=
1;this.isCollapsed=this._ranges[0].collapsed;n(this,a,false)}},h.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?s(this,a):b&&this.addRange(a[0])};else return t.fail("No means of selecting a Range or TextRange was found"),!1;h.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new B("INDEX_SIZE_ERR");return this._ranges[a]};var J;if(u)J=function(a){var e;if(b.isSelectionValid(a.win))e=a.docSelection.createRange();else{e=c.getBody(a.win.document).createTextRange();e.collapse(true)}a.docSelection.type==
"Control"?f(a):e&&typeof e.text!="undefined"?d(a,e):p(a)};else if(o.isHostMethod(x,"getRangeAt")&&"number"==typeof x.rangeCount)J=function(a){if(w&&F&&a.docSelection.type=="Control")f(a);else{a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount;if(a.rangeCount){for(var c=0,d=a.rangeCount;c<d;++c)a._ranges[c]=new b.WrappedRange(a.nativeSelection.getRangeAt(c));n(a,a._ranges[a.rangeCount-1],K(a.nativeSelection));a.isCollapsed=C(a)}else p(a)}};else if(E&&"boolean"==typeof x.isCollapsed&&"boolean"==
typeof N.collapsed&&b.features.implementsDomRange)J=function(a){var b;b=a.nativeSelection;if(b.anchorNode){b=H(b,0);a._ranges=[b];a.rangeCount=1;b=a.nativeSelection;a.anchorNode=b.anchorNode;a.anchorOffset=b.anchorOffset;a.focusNode=b.focusNode;a.focusOffset=b.focusOffset;a.isCollapsed=C(a)}else p(a)};else return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;h.refresh=function(a){var b=a?this._ranges.slice(0):null;J(this);if(a){a=b.length;if(a!=this._ranges.length)return false;
for(;a--;)if(!z.rangesEqual(b[a],this._ranges[a]))return false;return true}};var M=function(a,b){var c=a.getAllRanges(),d=false;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):d=true;a.rangeCount||p(a)};h.removeRange=w?function(a){if(this.docSelection.type=="Control"){for(var b=this.docSelection.createRange(),a=i(a),d=c.getDocument(b.item(0)),d=c.getBody(d).createControlRange(),e,h=false,j=0,l=b.length;j<l;++j){e=b.item(j);e!==a||h?d.add(b.item(j)):h=true}d.select();
f(this)}else M(this,a)}:function(a){M(this,a)};var K;!u&&E&&b.features.implementsDomRange?(K=function(a){var b=false;a.anchorNode&&(b=c.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return b},h.isBackwards=function(){return K(this)}):K=h.isBackwards=function(){return false};h.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};h.collapse=function(a,d){j(this,a);var e=b.createRange(c.getDocument(a));e.collapseToPoint(a,
d);this.removeAllRanges();this.addRange(e);this.isCollapsed=true};h.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new B("INVALID_STATE_ERR");};h.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new B("INVALID_STATE_ERR");};h.selectAllChildren=function(a){j(this,a);var d=b.createRange(c.getDocument(a));d.selectNodeContents(a);this.removeAllRanges();
this.addRange(d)};h.deleteFromDocument=function(){if(w&&F&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;){b=a.item(0);a.remove(b);b.parentNode.removeChild(b)}this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};h.getAllRanges=function(){return this._ranges.slice(0)};h.setSingleRange=function(a){this.setRanges([a])};h.containsNode=function(a,b){for(var c=
0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return true;return false};h.toHtml=function(){var a="";if(this.rangeCount){for(var a=z.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};h.getName=function(){return"WrappedSelection"};h.inspect=function(){return m(this)};h.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};l.inspect=
m;b.Selection=l;b.selectionPrototype=h;b.addCreateMissingNativeApiListener(function(a){if(typeof a.getSelection=="undefined")a.getSelection=function(){return b.getSelection(this)};a=null})});
